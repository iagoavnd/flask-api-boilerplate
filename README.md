# flask-api-boilerplate
A Flask boilerplate for building Dockerized APIs

## Prerequisites

Need to have [Docker](https://docs.docker.com/engine/installation/) installed.

## Getting Started
Clone the repo:
```
git clone https://github.com/mikaelm1/flask-api-boilerplate.git
```
A bash script will replace all the boilerplate names with the values that you provide. First, you need to make it an executable:
```
chmod +x create.sh
```
Then run the script:
```
./create.sh [APPNAME] [FirstName] [LastName] [EMAIL] [DBUsername] [DBPassword]
```

Once you're done with this script, you can delete `create.sh`

You can now run the app with Docker:
```
docker-compose up --build
```

## Security
Storing passwords and other sensitive information in version control is a bad idea. The `create.sh` script creates a directory called `instance`. You should store all sensitive data like databse passwords in `instance/settings.py`. All variables stored here will replace those of the same name found in `config/settings.py`.

## Running Tests
To run the unit tests: `docker exec [CONTAINER_ID] [APPNAME] tests`
To run them with a coverage report: `docker exec [CONTAINER_ID] [APPNAME] tests cov`. This will place the coverage reports inside a `tmp` directory. 

## Blueprints
You can create and delete blueprints with cli commands. Creating a blueprint will create the module with the given name inside the `blueprints` directory with `routes.py` and `models.py` files inside. The `routes.py` will have minimal code setup. Deleting a blueprint will delete all of its contents.

- To Create: `docker exec [CONTAINER_ID] [APPNAME] blueprint create [BLUEPRINTNAME]`
- To Delete: `docker exec [CONTAINER_ID] [APPNAME] blueprint delete [BLUEPRINTNAME]`

## Database Migrations
You can find the migrations folder inside the `app` package. All migrations will be stored inside `app/migrations/versions`. To autogenerate a migration script:
```
docker-compose exec [APPNAME] alembic revision --autogenerate -m "commit message"
```
Open up the newly generated version file and make sure the autogenerated code is exactly what you want (it's not always perfect and can't detect all changes). Once you're happy with the autogenerated code, run:
```
docker-compose exec [APPNAME] alembic upgrade head
```

## Mobile Push Notifications
The project contains a helper function to send iOS push notifications using [OneSignal](https://onesignal.com/). It makes a call to OneSignal's API to send a push notification to a single user (Planning to add other settings and Android options soon). 
```python
from util.push_notifications import notify_user
...
notify_user(player_id='the-id-stored-by-onesignal', title='Title', message='Body of the message', subtitle='Subtitle')
...
```
The `player_id` is an id that OneSignal creates when the user gives permission on their device to send them notifications. The iOS SDK that OneSignal provides allows you to get the user's id on the client. I would add an `os_player_id` field to the `User` model and save the id to the databse and use it when making the above call. 

## Logging
The boilerplate has a logger set up to write logs to `app.log`, which is inside the `logs/` directory. To use the logger:
```python
from flask import current_app
...
current_app.logger.error('Your message here')
...
```

## Acknowledgements
This boilerplate is heavily influenced by what I learned from these two sources:
- [Nick Janetakis's Flask Course](https://nickjanetakis.com/courses/build-a-saas-app-with-flask)
- [Miguel Grinberg's Book](https://www.amazon.com/Flask-Web-Development-Developing-Applications/dp/1449372627/ref=sr_1_2?ie=UTF8&qid=1491529179&sr=8-2&keywords=flask+book)
